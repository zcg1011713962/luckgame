<!DOCTYPE html>
<html>
  
  {include file="public/head" /}
    <style>
      .label-note {
        width: 100px;
        padding: 9px 10px;
      }
      .layui-input-block {
        margin-left: 130px !important;
      }
      .layui-form-select dl dd.layui-this {
          background-color: #393D49;
          color: #fff;
      }
    </style>
  <body>
    <div class="x-body">
        <form class="layui-form">
          <div class="layui-form-item">
            <label for="gameId" class="label-note  layui-form-label">
               游戏ID
            </label>
            <div class="layui-input-block">
                <input type="text" id="gameId" value="{$gameInfo['gameid']}" name="gameId" lay-verify="required|number" autocomplete="off" class="layui-input">
            </div>
        </div>
          <div class="layui-form-item">
              <label for="gameName" class="label-note layui-form-label">
                 游戏名称
              </label>
              <div class="layui-input-block">
                  <input type="text" id="gameName" name="gameName" value="{$gameInfo['name']}" lay-verify="required" autocomplete="off" class="layui-input">
              </div>
          </div>
          <div class="layui-form-item">
            <label for="gamePort" class="label-note layui-form-label">
               游戏端口
            </label>
            <div class="layui-input-block">
                <input type="text" id="gamePort" name="gamePort" value="{$gameInfo['port']}" lay-verify="required|number" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
          <label for="gameServer" class="label-note layui-form-label">
             游戏服务
          </label>
          <div class="layui-input-block">
              <input type="text" id="gameServer" name="gameServer" value="{$gameInfo['server']}" lay-verify="required|number" autocomplete="off" class="layui-input">
          </div>
        </div>
        <div class="layui-form-item">
          <label for="gameVersion" class="label-note layui-form-label">
             游戏版本
          </label>
          <div class="layui-input-block">
              <input type="text" id="gameVersion" value="{$gameInfo['version']}" name="gameVersion" autocomplete="off" class="layui-input">
          </div>
        </div>
		      <div class="layui-form-item">
              <label  class="label-note layui-form-label">
                游戏类型
              </label>
              <div class="layui-input-block">
                <select name="gameType" id="gameType" lay-verify="gameType">
                  <option value="0">请选择</option>
                  <option value="1" {if $gameInfo['type'] == 1} selected {/if}>棋牌类</option>
                  <option value="2" {if $gameInfo['type'] == 2} selected {/if}>SLOT类</option>
                  <option value="3" {if $gameInfo['type'] == 3} selected {/if}>其他类</option>
                </select>
              </div>		      
          </div>
          <div class="layui-form-item">
            <label for="choushuilv" class="label-note layui-form-label">
               抽水难度(1-10)
               <!-- <a href="javascript:;" title="水位值= 难度小于10 递增 5% , 难度大于10 递增 1%"><i class="fa fa-info-circle"></i></a> -->
            </label>
            <div class="layui-input-block">
                <input type="text" id="choushuilv" name="choushuilv" value="{$gameInfo['choushuilv']}" value="0" lay-verify="required|number|choushuilv" autocomplete="off" class="layui-input">
            </div>
          </div>
          <div class="layui-form-item">
            <label for="nandulv" class="label-note layui-form-label">
               游戏难度(1-10)
            </label>
            <div class="layui-input-block">
                <input type="text" id="nandulv" name="nandulv" value="{$gameInfo['nandulv']}" lay-verify="required|number|nandulv" autocomplete="off" class="layui-input">
            </div>
          </div>
          <div class="layui-form-item">
            <label class="label-note layui-form-label">水位游戏</label>
            <div class="layui-input-block">
              <input type="checkbox" id="isshuigame" name="isshuigame" lay-skin="switch" lay-filter="isshuigame" lay-text="开启|关闭" {if $gameInfo['isshuigame'] == 1} checked {/if}>
            </div>
          </div>
          <div class="shuiConfig" style="display: {if $gameInfo['isshuigame'] == 1} block {else} none {/if};">
          <!-- <div class="layui-form-item">
            <label for="waterLevel" class="label-note layui-form-label">
               水位值(%)
            </label>
            <div class="layui-input-block">
                <input type="text" value="0" id="waterLevel" name="waterLevel" lay-verify="waterLevel" autocomplete="off" class="layui-input">
            </div>
          </div> -->
          <div class="layui-form-item">
            <label for="balance" class="label-note layui-form-label">
               库存
            </label>
            <div class="layui-input-block">
                <input type="text" value="{$gameInfo['gamblingInfo']['nGamblingBalanceGold'] ? $gameInfo['gamblingInfo']['nGamblingBalanceGold'] : 0}" id="balance" name="balance" lay-verify="balance" autocomplete="off" class="layui-input">
            </div>
          </div>
          <div class="layui-form-item">
            <label for="winPool" class="label-note layui-form-label">
                奖池
            </label>
            <div class="layui-input-block">
                <input type="text" value="{$gameInfo['gamblingInfo']['nGamblingWinPool'] ? $gameInfo['gamblingInfo']['nGamblingWinPool'] : 0}" id="winPool" name="winPool" lay-verify="winPool" autocomplete="off" class="layui-input">
            </div>
          </div>
          <!-- <div class="layui-form-item">
            <label for="bigWinLevel" class="label-note layui-form-label">
                大奖幸运等级(千分概率)
            </label>
            <div class="layui-input-block">
                <input type="text" value="0,0,0" id="bigWinLevel" name="bigWinLevel" lay-verify="bigWinLevel" autocomplete="off" class="layui-input">
            </div>
          </div>
          <div class="layui-form-item">
            <label for="bigWinLuck" class="label-note layui-form-label">
                大奖幸运概率(百分概率)
            </label>
            <div class="layui-input-block">
                <input type="text" value="0,0,0" id="bigWinLuck" name="bigWinLuck" lay-verify="bigWinLuck" autocomplete="off" class="layui-input">
            </div>
          </div> -->
          <div class="layui-form-item">
            <label for="rtp" class="label-note layui-form-label">
                RTP
            </label>
            <div class="layui-input-block">
                <input type="text" value="{$gameInfo['gamblingInfo']['expectRTP'] ? $gameInfo['gamblingInfo']['expectRTP'] : 100 }" id="rtp" name="rtp" lay-verify="rtp" autocomplete="off" class="layui-input">
            </div>
          </div>
        </div>
          <div class="layui-form-item">
              <label for="L_repass" class="layui-form-label">
              </label>
              <button  class="layui-btn" lay-filter="edit" lay-submit="">
                  修改
              </button>
          </div>
      </form>
    </div>
    <script>
        layui.use(['form','layer'], function(){
            $ = layui.jquery;
            var form = layui.form,
                layer = layui.layer;
            
            // 水位游戏设置 0 非水位游戏 1 水位游戏
            var waterGame = 0;

            form.on('switch(isshuigame)',function(data){
              // 如果选择水位游戏，打开水位游戏选择框
              if(data.elem.checked) {
                waterGame = 1;
                $('.shuiConfig').show(100);
                return;
              }
              waterGame = 0;
              $('.shuiConfig').hide(100);
            })
        
          //自定义验证规则
          form.verify({
            gameType: function(value){
                if (value == 0) {
                  return '请选择游戏类型';
                }
            },
            choushuilv: function(value) {
              if (value > 10 && "{$gameInfo['choushuilv']}" <= 10) {
                return '抽水等级不能大于10';
              }
            },
            nandulv: function(value){
              if (value > 10) {
                return '难度等级不能大于10';
              }
            },
            // waterLevel: function(value) {
            //   if (isNaN(value*1) && waterGame == 1) {
            //     return '只能填写数字';
            //   }
            // },
            balance: function(value) {
              if (isNaN(value*1) && waterGame == 1) {
                return '只能填写数字';
              }
            },
            winPool: function(value) {
              if (isNaN(value*1) && waterGame == 1) {
                return '只能填写数字';
              }
            },
            rtp: function(value){
              if (isNaN(value*1) && waterGame == 1) {
                return '只能填写数字';
              }
            },
            // bigWinLevel: function(value) {
            //   if (value && waterGame == 1) {
            //     var formatArr = value.split(',');
            //     if (formatArr.length != 3) {
            //       return '输入格式有误，只能输入 x,x,x';
            //     }
            //     for (var i = 0; i < formatArr.length; i++) {
            //       if (isNaN(formatArr[i]*1)) {
            //         return '只能填写数字';
            //       }
            //     }
            //   }
            // },
            // bigWinLuck: function(value) {
            //   if (value && waterGame == 1) {
            //     var formatArr = value.split(',');
            //     if (formatArr.length != 3) {
            //       return '输入格式有误，只能输入 x,x,x';
            //     }
            //     for (var i = 0; i < formatArr.length; i++) {
            //       if (isNaN(formatArr[i]*1)) {
            //         return '只能填写数字';
            //       }
            //     }
            //   }
            // }
          });

          //监听提交
          form.on('submit(edit)', function(data){
              console.log(data.field);
            // 添加是否属于水深游戏
            data.field.waterGame = data.field.isshuigame == 'on' ? 1 : 0;
            data.field.id = "{$gameInfo['id']}";
            $.post("{:url('editGameaffirm')}",data.field,function(data){
              if (data.status == 0) {
                layer.alert(data.message, {icon: 6},function () {
						      var index = parent.layer.getFrameIndex(window.name);
						      parent.layer.close(index);
									parent.location.reload();
						   });
              } else {
                layer.msg(data.message);
              }
            },'Json');
            return false;
          });
        });
    </script>

  </body>

</html>